window._mfrAlpineRegistered=window._mfrAlpineRegistered||{},window._mfrAlpineRegistered.MFRArticlesFetcher||(document.addEventListener("alpine:init",()=>{Alpine.data("MFRArticlesFetcher",({blogTitle:e,excludeTaggedWith:t=[],showOnlyTaggedWith:s=[],includeTagsUseAny:i=!1,pageSize:a=50,metafields:r=[],appendMode:h=!1})=>({VERSION:"2025-07",API_URL:null,TOKEN:"58186b44f75c0208944765a0a2b4cdb0",QUERY:`\n        query($first:Int!, $after:String, $q:String!, $metafields:[HasMetafieldsIdentifier!]!) {\n          articles(first: $first, after: $after, query: $q, sortKey: PUBLISHED_AT, reverse: true) {\n            edges {\n              cursor\n              node {\n                id\n                handle\n                title\n                blog { handle }\n                tags\n                publishedAt\n                image {\n                  height\n                  width\n                  url(transform: {maxWidth: 720, preferredContentType: WEBP})\n                }\n                ${r.length?"\n                    metafields(identifiers: $metafields) {\n                      key\n                      value\n                    }":""}\n              }\n            }\n            pageInfo { hasNextPage }\n          }\n        }\n      `,term:"",blogTitle:e,excludeTaggedWith:t,showOnlyTaggedWith:s,includeTagsUseAny:i,pageSize:a,appendMode:h,shownArticles:[],loading:!1,error:"",noResult:!1,page:1,hasNext:!1,hasPrev:!1,_pageItems:Object.create(null),_pageCursors:{1:null},_hasNextMap:Object.create(null),mfKeys:["read_time"],_saved:Object.create(null),metafieldIdentifiers(){return(this.mfKeys&&this.mfKeys.length?this.mfKeys:["nice_title"]).map(e=>({namespace:"mfr_fields",key:e}))},_termKey(){return[(this.blogTitle||"").toLowerCase(),(this.term||"").trim().toLowerCase(),(this.excludeTaggedWith||[]).map(e=>String(e).toLowerCase()).sort().join(","),(this.showOnlyTaggedWith||[]).map(e=>String(e).toLowerCase()).sort().join(","),this.includeTagsUseAny?"any":"all",String(this.pageSize)].join("|")},_getSaved(e){return this._saved[e]||null},_save(e,t){this._saved[e]=t},init(){this.API_URL=`/api/${this.VERSION}/graphql.json`,this.$watch("term",()=>this.searchFirstPage()),this.$watch("excludeTaggedWith",()=>this.searchFirstPage()),this.$watch("showOnlyTaggedWith",()=>this.searchFirstPage()),this.$watch("includeTagsUseAny",()=>this.searchFirstPage()),this.$watch("page",e=>this.fetchPage({page:Number(e)||1})),this.searchFirstPage()},buildQuery(e,t="",s=[],i=[],a=!1){const r=e=>`"${String(e).replace(/"/g,'\\"')}"`,h=[];t&&h.push(`blog_title:${r(t)}`),e&&h.push(`${e}*`);const n=(i||[]).filter(Boolean);if(n.length)if(a){const e=n.map(e=>`tag:${r(e)}`).join(" OR ");h.push(`(${e})`)}else n.forEach(e=>h.push(`tag:${r(e)}`));return(s||[]).filter(Boolean).forEach(e=>h.push(`NOT tag:${r(e)}`)),h.join(" ").trim()},async sf(e,t={}){const s=await axios.post(this.API_URL,{query:e,variables:t},{headers:{"Content-Type":"application/json","X-Shopify-Storefront-Access-Token":this.TOKEN}}),{data:i,errors:a}=s.data||{};if(a)throw a;return i},async _fetchServerPage(e){const t=this.buildQuery(this.term,this.blogTitle,this.excludeTaggedWith,this.showOnlyTaggedWith,this.includeTagsUseAny),s={first:this.pageSize,after:e,q:t,metafields:this.metafieldIdentifiers()},{articles:i}=await this.sf(this.QUERY,s);let a=(i.edges||[]).map(e=>{const t=e.node,s=t.blog?.handle||this.blogTitle||"",i=s?`/blogs/${s}/${t.handle}`:null;let a;return t.metafields&&(a=t.metafields.length&&t.metafields[0]?Object.fromEntries((t.metafields||[]).map(e=>[e.key,e.value])):[]),{...t,url:i,metafields:a}});if(this.excludeTaggedWith?.length){const e=new Set(this.excludeTaggedWith.map(e=>String(e).toLowerCase()));a=a.filter(t=>!(t.tags||[]).some(t=>e.has(String(t).toLowerCase())))}if(this.showOnlyTaggedWith?.length){const e=this.showOnlyTaggedWith.map(e=>String(e).toLowerCase());a=a.filter(t=>{const s=new Set((t.tags||[]).map(e=>String(e).toLowerCase()));return this.includeTagsUseAny?e.some(e=>s.has(e)):e.every(e=>s.has(e))})}return{items:a,endCursor:i.edges.at(-1)?.cursor??null,hasNext:!!i.pageInfo?.hasNextPage}},async _ensureCursorForPage(e){if(void 0!==this._pageCursors[e])return this._pageCursors[e];let t=Object.keys(this._pageCursors).map(Number).filter(t=>t<e).sort((e,t)=>t-e)[0]||1,s=this._pageCursors[t];for(let i=t;i<e;i++){const{items:e,endCursor:t,hasNext:a}=await this._fetchServerPage(s);if(this._pageItems[i]=e,this._hasNextMap[i]=a,this._pageCursors[i+1]=t,s=t,!e.length&&!a)break}return this._pageCursors[e]},async fetchPage({page:e=1}={}){if(e=Math.max(1,Number(e)||1),!this.loading){this.loading=!0,this.error="";try{const t=await this._ensureCursorForPage(e);let s,i=this._pageItems[e];if(!i){const a=await this._fetchServerPage(t);i=a.items,s=a.hasNext,this._pageItems[e]=i,this._hasNextMap[e]=!!s,this._pageCursors[e+1]=a.endCursor}this.page=e,this.hasPrev=e>1,this.hasNext=!!this._hasNextMap[e],this.appendMode?this.shownArticles=[...this.shownArticles,...i]:this.shownArticles=i,this.noResult=0===this.shownArticles.length,1===e&&this._save(this._termKey(),{pageSize:this.pageSize,page1Items:i,page1HasNext:!!this._hasNextMap[1],page1EndCursor:this._pageCursors[2]??null}),this.$nextTick(()=>{ScrollTrigger&&ScrollTrigger.refresh&&ScrollTrigger.refresh()})}catch(e){this.error="Something went wrong loading articles.",console.error(e)}finally{this.loading=!1}}},async searchFirstPage(){this._pageItems=Object.create(null),this._pageCursors={1:null},this._hasNextMap=Object.create(null),this.shownArticles=[],this.appendMode=!1,this.page=1;const e=this._termKey(),t=this._getSaved(e);t&&t.pageSize===this.pageSize&&Array.isArray(t.page1Items)?(this._pageItems[1]=t.page1Items,this.shownArticles=t.page1Items,this.noResult=0===this.shownArticles.length,this._hasNextMap[1]=t.page1HasNext??!0,null!=t.page1EndCursor&&(this._pageCursors[2]=t.page1EndCursor),this.$nextTick(()=>{window.ScrollTrigger&&window.ScrollTrigger.refresh&&window.ScrollTrigger.refresh()})):await this.fetchPage({page:1})},async nextPage(){if(this.loading)return;!1!==this._hasNextMap[this.page]&&(this.page=this.page+1)},async prevPage(){this.loading||this.page<=1||(this.page=this.page-1)}}))}),window._mfrAlpineRegistered.MFRArticlesFetcher=!0);
//# sourceMappingURL=mfr-component__MFRArticlesFetcher.min.js.map

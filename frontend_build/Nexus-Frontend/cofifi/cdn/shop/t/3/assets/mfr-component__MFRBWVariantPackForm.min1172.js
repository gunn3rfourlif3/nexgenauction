window._mfrAlpineRegistered=window._mfrAlpineRegistered||{},window._mfrAlpineRegistered.MFRBWVariantPackForm||(document.addEventListener("alpine:init",()=>{Alpine.data("MFRBWVariantPackForm",()=>({limit:0,currentPacks:[],canAdd:!0,freqMessage:"",frequencyNote:"",onCartOpenFunctions:[],productProperties:[],$hiddenInput:null,$frequency:null,selectedSellingPlanID:null,$wrapper:null,init(){this.$frequency=this.$el.querySelector("[name='frequency']"),this.$initiallySelectedFrequency=this.$el.querySelector("[name='frequency']:checked"),this.$wrapper=this.$el,this.saveHiddenInputs(),this.setLimit()},setLimit(e){if(e||0===e)return this.limit=Number(e)||0,void this.$nextTick(()=>{ScrollTrigger&&ScrollTrigger.refresh&&ScrollTrigger.refresh()})},setMessage(e,t,i){this.shipMessage=e,this.freqMessage=t,this.frequencyNote=i},isInPack(e){return this.currentPacks.filter(t=>t.id===e).length},isSingleSelect(){return 1===Number(this.limit)},toggleSingleSelection(e){e?.id&&this.isSingleSelect()&&(this.isInPack(e.id)?this.decreaseFromPack(e):this.currentPacks=[e])},addToPack(e){e?.id&&(this.isSingleSelect()?this.currentPacks=[e]:this.isFull()||this.currentPacks.push(e))},isFull(){return this.currentPacks.length>=Number(this.limit||0)},reset(){this.currentPacks=[]},decreaseFromPack(e){if(!e.id||this.currentPacks.length<=0)return;const t=this.currentPacks.findLastIndex(t=>t.id===e.id);-1!==t&&this.currentPacks.splice(t,1)},async addToCart(e){const t={items:[]};t.items=this.generateItemsPayload(e),Alpine.store("offCanvasCart").openOffcanvas(),this.$el.closest("#offCanvasProductForm")&&this.$store.offCanvasProductForm.closeOffcanvas(),this.onCartOpenFunctions.forEach(e=>e()),Alpine.store("pdp").addToCartAddons();await axios.post(window.Shopify.routes.root+"cart/add.js",t,{headers:{"Content-Type":"application/json"}});Alpine.store("cart").getCartData(),this.reset()},generateTimeHash:()=>btoa(Date.now().toString()+Math.random().toString()).replace(/=/g,""),generateItemsPayload(e){const t=`bundle-${this.generateTimeHash()}`,i=[...new Set(this.currentPacks.map(e=>e.variantTitle))].join("/");this.$el.querySelector("[name='frequency']:checked");return this.currentPacks.reduce((r,n)=>{const a=r.find(e=>e.id===n.id);if(a)a.quantity++;else{let a={_mfr_bundle_hash:t,"Part of":`${i} bundle`,_nice_title:e.niceTitle};this.productProperties.forEach(e=>{a[e.key]=e.value});const s={id:n.id,quantity:1,properties:a};this.selectedSellingPlanID&&(s.selling_plan=this.selectedSellingPlanID),r.push(s)}return r},[])},onCartOpen(e){"function"==typeof e&&this.onCartOpenFunctions.push(e)},saveHiddenInputs(){this.$hiddenInput=this.$el.closest('[x-data="MFRBWVariantPackForm"]').querySelectorAll("input[name^='properties']");const e=Array.from(this.$hiddenInput).map(e=>{const t=e.name.match(/^properties\[(.+?)\]$/),i=t?t[1]:null;return i?{key:i,value:e.value}:null}).filter(Boolean);this.productProperties=e},setSellingPlanID(e){this.selectedSellingPlanID=e},sendGA4Datalayer(e){const t=this.$wrapper.querySelector(".variant-pack-form__selectors"),i=Alpine.$data(t).variantData,r=this.$wrapper.querySelector(".variant-pack-form__frequencies"),n=Alpine.$data(r).frequencyTitle,a=window.Shopify?.currency?.active||"USD",s=Number(i.variantPrice||0)/100,c={item_id:i.variantId,item_name:i.productTitle,item_variant:i.variantTitle,item_brand:i.productVendor,item_category:i.productType||"Uncategorized",item_category_2:n,item_category_3:`${i.productTitle} - ${i.variantTitle}`,full_name:`${i.productTitle} - ${i.variantTitle}`,purchase_type:n,price:s,quantity:1};window.dataLayer=window.dataLayer||[],window.dataLayer.push({ecommerce:null}),window.dataLayer.push({event:"view_item",ecommerce:{currency:a,value:1*s,items:[c]},view_context:e})}}))}),window._mfrAlpineRegistered.MFRBWVariantPackForm=!0);
//# sourceMappingURL=mfr-component__MFRBWVariantPackForm.min.js.map
